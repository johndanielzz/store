<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MatrixMarket - Seller Withdraw</title>
<style>
  body {
    font-family:"Poppins",sans-serif;
    background:linear-gradient(-45deg,#0f172a,#1e293b,#4f46e5,#06b6d4);
    background-size:400% 400%;
    animation:bgMove 12s ease infinite;
    color:white;
    margin:0; padding:0;
  }
  @keyframes bgMove{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
  
  header {
    background: rgba(0,0,0,0.4);
    padding: 15px 30px;
    display:flex; justify-content:space-between; align-items:center;
    backdrop-filter: blur(10px);
  }
  header .logo { font-size:1.6rem; color:#06b6d4; font-weight:bold; }
  nav a { color:white; text-decoration:none; margin-left:15px; font-weight:500; }
  nav a:hover { color:#06b6d4; }

  .container { max-width:800px; margin:40px auto; background: rgba(255,255,255,0.08); padding:30px; border-radius:20px; box-shadow:0 0 20px rgba(6,182,212,0.5); }

  h1 { text-align:center; margin-bottom:20px; text-shadow:0 0 10px #06b6d4; }
  
  .withdraw-form { display:flex; flex-direction:column; gap:15px; margin-bottom:30px; }
  .withdraw-form input { padding:12px; border-radius:10px; border:none; background: rgba(255,255,255,0.1); color:white; font-size:1rem; }
  .withdraw-form input:focus { outline:none; box-shadow:0 0 12px #06b6d4; }
  
  .withdraw-form button { padding:12px; border:none; border-radius:12px; background:linear-gradient(90deg,#06b6d4,#4f46e5); color:white; font-weight:bold; cursor:pointer; transition:.3s; }
  .withdraw-form button:hover { transform:scale(1.05); box-shadow:0 0 20px #06b6d4; }
  
  .info { font-size:0.95rem; margin-top:5px; color:#f0f0f0; }
  
  table { width:100%; border-collapse:collapse; margin-top:20px; overflow-x:auto; }
  th,td { border:1px solid rgba(255,255,255,0.2); padding:10px; text-align:center; }
  th { background: rgba(6,182,212,0.3); }
  tr:hover { background: rgba(255,255,255,0.05); }
  
  .status { padding:4px 10px; border-radius:6px; font-weight:bold; }
  .status-pending { background: rgba(245,158,11,0.2); color:#f59e0b; }
  .status-approved { background: rgba(34,197,94,0.2); color:#22c55e; }
  .status-declined { background: rgba(239,68,68,0.2); color:#ef4444; }

  footer { text-align:center; padding:15px; background: rgba(255,255,255,0.08); border-top:1px solid rgba(255,255,255,0.1); margin-top:40px; }
</style>
</head>
<body>

<header>
  <div class="logo">MatrixMarket Seller</div>
  <nav>
    <a href="seller-dashboard.html">Dashboard</a>
    <a href="seller-products.html">Products</a>
    <a href="seller-withdraw.html" style="font-weight:bold;color:#06b6d4;">Withdraw</a>
  </nav>
</header>

<div class="container">
  <h1>ðŸ’° Withdraw Earnings</h1>

  <div class="withdraw-form">
    <input type="number" id="withdrawAmount" placeholder="Enter amount (GMD 100 - 3,000,000)" min="100" max="3000000" oninput="calculateNet()">
    <div class="info" id="chargeInfo">Charge: GMD 2 per 100 withdrawn. Net amount will be displayed below.</div>
    <div class="info" id="netAmount">Net Amount: GMD 0</div>
    <button onclick="submitWithdraw()">Submit Withdraw Request</button>
  </div>

  <h2>Previous Withdrawals</h2>
  <table id="withdrawTable">
    <tr>
      <th>Amount Requested (GMD)</th>
      <th>Charge (GMD)</th>
      <th>Net Received (GMD)</th>
      <th>Status</th>
      <th>Requested On</th>
    </tr>
  </table>
</div>

<footer>Â© 2025 MatrixMarket | Seller Withdrawals</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";

const firebaseConfig = {
  apiKey:"AIzaSyDFrctk2MZajP7OmECXe5npHAV0dODH9jk",
  authDomain:"matrixmarketplace-1bd71.firebaseapp.com",
  databaseURL:"https://matrixmarketplace-1bd71-default-rtdb.firebaseio.com",
  projectId:"matrixmarketplace-1bd71",
  storageBucket:"matrixmarketplace-1bd71.firebasestorage.app",
  messagingSenderId:"10374416997",
  appId:"1:10374416997:web:9626c569e845c14a87548c",
  measurementId:"G-DTC2GM9L92"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

let currentUser = null;

onAuthStateChanged(auth,user=>{
  if(!user){ alert("Login required."); window.location.href="login.html"; return; }
  currentUser = user;
  loadWithdrawals();
});

function calculateNet(){
  const amount = parseInt(document.getElementById('withdrawAmount').value)||0;
  if(amount<100 || amount>3000000){ document.getElementById('netAmount').innerText="Net Amount: GMD 0"; return; }
  const charge = Math.floor(amount/100)*2;
  const net = amount - charge;
  document.getElementById('netAmount').innerText = `Net Amount: GMD ${net} (Charge: GMD ${charge})`;
}

async function submitWithdraw(){
  const amount = parseInt(document.getElementById('withdrawAmount').value)||0;
  if(amount<100 || amount>3000000){ alert("Amount must be between 100 and 3,000,000 GMD."); return; }
  const charge = Math.floor(amount/100)*2;
  const net = amount - charge;

  const data = {
    amount: amount,
    charge: charge,
    net: net,
    status: "Pending",
    requestedAt: new Date().toISOString(),
    userId: currentUser.uid
  };

  try{
    await push(ref(db,'sellerWithdrawals'), data);
    alert(`Withdrawal request submitted! Net amount you will receive: GMD ${net}`);
    document.getElementById('withdrawAmount').value="";
    document.getElementById('netAmount').innerText="Net Amount: GMD 0";
  }catch(e){ console.error(e); alert("Error submitting withdrawal request."); }
}

function loadWithdrawals(){
  const table = document.getElementById('withdrawTable');
  const withdrawalsRef = ref(db,'sellerWithdrawals');
  onValue(withdrawalsRef,snapshot=>{
    table.innerHTML=`<tr>
      <th>Amount Requested (GMD)</th>
      <th>Charge (GMD)</th>
      <th>Net Received (GMD)</th>
      <th>Status</th>
      <th>Requested On</th>
    </tr>`;
    const data = snapshot.val()||{};
    Object.keys(data).forEach(key=>{
      const w = data[key];
      if(w.userId!==currentUser.uid) return; // Only show current user's withdrawals
      const date = w.requestedAt ? new Date(w.requestedAt).toLocaleString() : "N/A";
      table.innerHTML += `<tr>
        <td>${w.amount}</td>
        <td>${w.charge}</td>
        <td>${w.net}</td>
        <td><span class="status status-${w.status.toLowerCase()}">${w.status}</span></td>
        <td>${date}</td>
      </tr>`;
    });
  });
}
</script>
</body>
</html>
